<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Humas & BKK SMK Ma'arif NU Bobotsari</title>

  <!-- Fonts & Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet" /><link rel="icon" href="LP-Maarif.png" type="image/png">

  <style>
    body { font-family: 'Poppins', sans-serif; scroll-behavior: smooth; }
    .divider { height: 1px; background-color: #e6eef0; margin: 3rem 0; }
    .nav-active { color: #facc15 !important; }
    .modal-bg { background: rgba(0,0,0,0.45); }
    .no-select { user-select: none; -webkit-user-select: none; }
    #adminPanel { display: none; }
    .img-cover { object-fit: cover; }
    /* Mobile tweaks */
    /* üåø MOBILE OPTIMIZATION */
    @media (max-width: 640px) {
      header { flex-wrap: wrap; padding: 0.5rem 1rem; }
      header img { height: 32px; }
      header h1 { font-size: 14px; }
      header p { font-size: 11px; }
      nav ul { gap: 0.75rem; }
      .nav-link { font-size: 13px; }
      #home { height: 180px; }
      #home h2 { font-size: 13px; line-height: 1.4; }
      .max-w-3xl { max-width: 92%; }
      .p-6 { padding: 0.75rem; }
      section h2 { font-size: 18px; }
      .card-img { height: 9rem; }
      .rounded-circle { width: 80px; height: 80px; }
      #kontak p { font-size: 13px; line-height: 1.5; }
    }
      header img { height: 36px; }
      #home h2 { font-size: 16px; }
      .max-w-3xl { max-width: 94%; }
      .nav-link { font-size: 14px; }
      .img-cover { object-position: center; }
      /* Reduce hero height on small screens */
      #home { height: 260px; }
      /* tighter paddings */
      .p-6 { padding: 0.75rem; }
    }
    /* Ensure images in cards keep proportions and don't overflow */
    .card-img { width: 100%; height: 12rem; object-fit: cover; border-radius: 0.5rem; }
    .rounded-circle { border-radius: 9999px; object-fit: cover; }
    /* Admin modal vertical scroll on small screens */
    #adminPanel .max-w-6xl { max-width: 98%; margin: 1rem; }
    /* Make export/import buttons inline on mobile */
    .admin-actions { display:flex; gap:0.5rem; flex-wrap:wrap; }
  </style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- HEADER -->
  <header class="bg-green-800 text-white flex items-center justify-between px-6 py-3 shadow-md sticky top-0 z-40">
    <div class="flex items-center gap-3">
      <img src="LP-Maarif.png" alt="Logo LP" class="h-10 md:h-12">
      <div>
        <h1 class="text-lg md:text-xl font-semibold">Humas & BKK SMK Ma'arif NU Bobotsari</h1>
        <p class="text-xs opacity-90">Portal Informasi Sekolah & Bursa Kerja Khusus</p>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <a id="btn-admin-open" href="#admin" class="bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full text-sm no-select">Admin</a>
      <a href="#kontak" class="bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full text-sm no-select">Kontak</a>
    </div>
  </header>

  <!-- NAVBAR -->
  <nav id="navbar" class="bg-green-600 text-white py-2 z-30 shadow-sm">
    <ul class="flex flex-wrap justify-center gap-6 font-semibold px-3">
      <li><a href="#home" class="nav-link hover:text-yellow-200 transition">Home</a></li>
      <li><a href="#berita" class="nav-link hover:text-yellow-200 transition">Berita</a></li>
      <li><a href="#info-pt" class="nav-link hover:text-yellow-200 transition">Info PT</a></li>
      <li><a href="#lowongan" class="nav-link hover:text-yellow-200 transition">Lowongan</a></li>
      <li><a href="#pengurus" class="nav-link hover:text-yellow-200 transition">Pengurus</a></li>
      <li><a href="#kontak" class="nav-link hover:text-yellow-200 transition">Kontak</a></li>
      <li><a href="#admin" class="nav-link hover:text-yellow-200 transition">Dashboard</a></li>
    </ul>
  </nav>

  <!-- HERO / BANNER -->
  <section id="home" class="relative h-[320px] md:h-[420px] flex items-center justify-center text-center text-white">
    <img src="ALUMNI-2025-SMK-MAARIF-NU-BOBOTSARI.jpg" class="absolute inset-0 w-full h-full img-cover" alt="Banner">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative px-6 max-w-3xl" data-aos="zoom-in">
      <h2 class="text-xl md:text-2xl font-semibold leading-relaxed drop-shadow-md" id="heroText">
        Terwujudnya sekolah yang kuat, tepercaya, insan berintegritas Ahlussunnah Wal Jama'ah an-Nahdliyah,
        pembelajar, mumpuni dan berkompetensi serta berterima di masyarakat, Dunia Usaha dan Dunia Industri (DUDI)
      </h2>
      <a href="#berita" class="inline-block mt-4 md:mt-6 bg-green-500 hover:bg-green-600 text-white px-5 py-2 rounded-full font-semibold transition transform hover:scale-105 shadow-md">Lihat Info Terbaru</a>
    </div>
  </section>

  <!-- MAIN CONTENT -->
  <main class="max-w-7xl mx-auto px-4 py-8 md:py-10 space-y-10">

    <!-- BERITA -->
    <section id="berita" data-aos="fade-up">
      <div class="flex items-center justify-between">
        <h2 class="text-2xl font-bold text-green-800 border-l-4 border-green-500 pl-3">Berita Terbaru</h2>
        <button id="btn-add-news-quick" class="hidden md:inline-block bg-green-600 text-white px-3 py-1 rounded-lg text-sm">Tambah Berita</button>
      </div>
      <div id="newsGrid" class="mt-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </section>

    <div class="divider"></div>

    <!-- INFO PT -->
    <section id="info-pt" data-aos="fade-up">
      <h2 class="text-2xl font-bold text-green-800 border-l-4 border-green-500 pl-3">Informasi Perguruan Tinggi</h2>
      <div id="infoPTGrid" class="mt-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </section>

    <div class="divider"></div>

    <!-- LOWONGAN -->
    <section id="lowongan" data-aos="fade-up">
      <h2 class="text-2xl font-bold text-green-800 border-l-4 border-green-500 pl-3">Lowongan Pekerjaan</h2>
      <div id="jobsGrid" class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6"></div>
    </section>

    <div class="divider"></div>

    <!-- PENGURUS -->
    <section id="pengurus" data-aos="fade-up">
      <h2 class="text-2xl font-bold text-green-800 border-l-4 border-green-500 pl-3">Struktural Humas & BKK</h2>
      <div id="staffGrid" class="mt-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 text-center"></div>
    </section>

    <div class="divider"></div>

    <!-- KONTAK -->
    <section id="kontak" data-aos="fade-up">
      <h2 class="text-2xl font-bold text-green-800 border-l-4 border-green-500 pl-3">Kontak Kami</h2>
      <p class="text-gray-700 mt-4">
        üìß Email: humasmabos1@gmail.com<br>
        ‚òéÔ∏è Telepon: 0831-3625-2917 (Admin Humas & BKK)<br>
        üìç Alamat: Jl. Kampung Baru, Dusun III, Gandasuli, Bobotsari, Purbalingga, Jawa Tengah
      </p>
    </section>

  </main>

  <!-- BACK TO TOP -->
  <button id="toTop" class="fixed bottom-5 right-5 bg-green-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-green-700 transition hidden">‚¨ÜÔ∏è</button>

  <!-- ADMIN: LOGIN MODAL -->
  <div id="loginModal" class="fixed inset-0 hidden items-center justify-center modal-bg z-50">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6">
      <h3 class="text-lg font-semibold mb-2">Admin Login</h3>
      <p class="text-sm text-gray-600 mb-4">Masuk untuk mengelola konten situs.</p>
      <div class="space-y-3">
        <input id="loginUser" type="text" placeholder="Username" class="w-full border px-3 py-2 rounded-lg" />
        <input id="loginPass" type="password" placeholder="Password" class="w-full border px-3 py-2 rounded-lg" />
        <div class="flex items-center justify-between">
          <button id="loginBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg">Masuk</button>
          <button id="loginClose" class="text-sm text-gray-500">Batal</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN PANEL (hidden kecuali login) -->
  <div id="adminPanel" class="fixed inset-0 z-50 bg-white/60 backdrop-blur-sm p-6 overflow-auto">
    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden grid md:grid-cols-4">
      <!-- SIDEBAR -->
      <aside class="md:col-span-1 bg-white p-6 border-r">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-green-700 font-semibold">IQ</div>
          <div>
            <div id="adminName" class="font-semibold">Admin</div>
            <div class="text-xs text-gray-500">Logged in</div>
          </div>
        </div>

        <nav class="space-y-2">
          <button class="admin-menu w-full text-left px-3 py-2 rounded-lg hover:bg-green-50" data-section="dash">üè† Dashboard</button>
          <button class="admin-menu w-full text-left px-3 py-2 rounded-lg hover:bg-green-50" data-section="berita">üì∞ Kelola Berita</button>
          <button class="admin-menu w-full text-left px-3 py-2 rounded-lg hover:bg-green-50" data-section="infopt">üéì Kelola Info PT</button>
          <button class="admin-menu w-full text-left px-3 py-2 rounded-lg hover:bg-green-50" data-section="lowongan">üíº Kelola Lowongan</button>
          <button class="admin-menu w-full text-left px-3 py-2 rounded-lg hover:bg-green-50" data-section="pengurus">üë• Kelola Pengurus</button>
        </nav>

        <div class="mt-6 border-t pt-4 admin-actions">
          <button id="btnExport" class="w-full bg-green-600 text-white px-3 py-2 rounded-lg mb-2">Export data (JSON)</button>
          <label for="importFile" class="w-full bg-blue-600 text-white px-3 py-2 rounded-lg mb-2 text-center cursor-pointer">Import data (JSON)</label>
          <input type="file" id="importFile" accept=".json" style="display:none">
          <button id="btnReset" class="w-full bg-red-500 text-white px-3 py-2 rounded-lg mb-2">Reset ke default</button>
          <button id="btnLogout" class="w-full border px-3 py-2 rounded-lg">Logout</button>
        </div>
      </aside>

      <!-- CONTENT -->
      <div class="md:col-span-3 p-6">
        <!-- DASHBOARD HOME -->
        <div id="admin-dash" class="admin-section">
          <h3 class="text-xl font-semibold mb-4">Dashboard</h3>
          <div class="grid md:grid-cols-3 gap-4">
            <div class="p-4 rounded-xl bg-green-50">
              <div class="text-sm text-gray-600">Jumlah Berita</div>
              <div id="countNews" class="text-2xl font-semibold text-green-700">0</div>
            </div>
            <div class="p-4 rounded-xl bg-blue-50">
              <div class="text-sm text-gray-600">Jumlah Info PT</div>
              <div id="countInfoPT" class="text-2xl font-semibold text-blue-700">0</div>
            </div>
            <div class="p-4 rounded-xl bg-yellow-50">
              <div class="text-sm text-gray-600">Jumlah Lowongan</div>
              <div id="countJobs" class="text-2xl font-semibold text-yellow-700">0</div>
            </div>
          </div>
          <div class="mt-6">
            <h4 class="font-semibold mb-2">Aktivitas Terakhir</h4>
            <ul id="adminLog" class="text-sm text-gray-600 list-disc pl-5"></ul>
          </div>
        </div>

        <!-- KELOLA BERITA -->
        <div id="admin-berita" class="admin-section hidden">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-semibold">Kelola Berita</h3>
            <div class="flex gap-2">
              <button id="btnNewNews" class="bg-green-600 text-white px-3 py-2 rounded-lg">Tambah Berita</button>
              <button id="btnCloseNewsPanel" class="text-sm px-3 py-2 rounded-lg border">Tutup</button>
            </div>
          </div>

          <!-- Form tambah/edit -->
          <form id="formNews" class="bg-white border p-4 rounded-lg mb-4 hidden">
            <input type="hidden" id="newsId" />
            <div class="grid md:grid-cols-2 gap-3">
              <input id="newsTitle" placeholder="Judul berita" class="border px-3 py-2 rounded-lg" required />
              <input id="newsDate" type="date" class="border px-3 py-2 rounded-lg" />
            </div>
            <input id="newsImage" placeholder="URL gambar (opsional)" class="border px-3 py-2 rounded-lg mt-3" />
            <textarea id="newsExcerpt" placeholder="Ringkasan singkat" class="border px-3 py-2 rounded-lg mt-3"></textarea>
            <textarea id="newsContent" placeholder="Isi lengkap berita (HTML diizinkan)" class="border px-3 py-2 rounded-lg mt-3" rows="6"></textarea>

            <div class="flex gap-2 mt-3">
              <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg">Simpan</button>
              <button type="button" id="btnCancelNews" class="border px-4 py-2 rounded-lg">Batal</button>
            </div>
          </form>

          <!-- Daftar berita -->
          <div id="newsList" class="space-y-3"></div>
        </div>

        <!-- KELOLA INFO PT -->
        <div id="admin-infopt" class="admin-section hidden">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-semibold">Kelola Info Perguruan Tinggi</h3>
            <button id="btnNewInfoPT" class="bg-green-600 text-white px-3 py-2 rounded-lg">Tambah</button>
          </div>

          <form id="formInfoPT" class="bg-white border p-4 rounded-lg mb-4 hidden">
            <input type="hidden" id="infoId" />
            <div class="grid md:grid-cols-2 gap-3">
              <input id="infoTitle" placeholder="Nama / Judul" class="border px-3 py-2 rounded-lg" required />
              <input id="infoLink" placeholder="Link pendaftaran / info" class="border px-3 py-2 rounded-lg" />
            </div>
            <input id="infoImage" placeholder="URL logo / gambar (opsional)" class="border px-3 py-2 rounded-lg mt-3" />
            <textarea id="infoExcerpt" placeholder="Deskripsi singkat" class="border px-3 py-2 rounded-lg mt-3"></textarea>

            <div class="flex gap-2 mt-3">
              <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg">Simpan</button>
              <button type="button" id="btnCancelInfo" class="border px-4 py-2 rounded-lg">Batal</button>
            </div>
          </form>

          <div id="infoList" class="space-y-3"></div>
        </div>

        <!-- KELOLA LOWONGAN -->
        <div id="admin-lowongan" class="admin-section hidden">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-semibold">Kelola Lowongan</h3>
            <button id="btnNewJob" class="bg-green-600 text-white px-3 py-2 rounded-lg">Tambah Lowongan</button>
          </div>

          <form id="formJob" class="bg-white border p-4 rounded-lg mb-4 hidden">
            <input type="hidden" id="jobId" />
            <div class="grid md:grid-cols-2 gap-3">
              <input id="jobTitle" placeholder="Judul lowongan" class="border px-3 py-2 rounded-lg" required />
              <input id="jobCompany" placeholder="Perusahaan" class="border px-3 py-2 rounded-lg" />
            </div>
            <input id="jobImage" placeholder="URL logo / gambar (opsional)" class="border px-3 py-2 rounded-lg mt-3" />
            <input id="jobLink" placeholder="Link apply (opsional)" class="border px-3 py-2 rounded-lg mt-3" />
            <textarea id="jobExcerpt" placeholder="Deskripsi singkat" class="border px-3 py-2 rounded-lg mt-3"></textarea>

            <div class="flex gap-2 mt-3">
              <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg">Simpan</button>
              <button type="button" id="btnCancelJob" class="border px-4 py-2 rounded-lg">Batal</button>
            </div>
          </form>

          <div id="jobList" class="space-y-3"></div>
        </div>

        <!-- KELOLA PENGURUS -->
        <div id="admin-pengurus" class="admin-section hidden">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-semibold">Kelola Pengurus</h3>
            <button id="btnNewStaff" class="bg-green-600 text-white px-3 py-2 rounded-lg">Tambah Pengurus</button>
          </div>

          <form id="formStaff" class="bg-white border p-4 rounded-lg mb-4 hidden">
            <input type="hidden" id="staffId" />
            <div class="grid md:grid-cols-2 gap-3">
              <input id="staffName" placeholder="Nama lengkap" class="border px-3 py-2 rounded-lg" required />
              <input id="staffRole" placeholder="Jabatan (mis. Ketua BKK)" class="border px-3 py-2 rounded-lg" />
            </div>
            <input id="staffImage" placeholder="URL foto (opsional)" class="border px-3 py-2 rounded-lg mt-3" />
            <input id="staffWA" placeholder="Nomor WhatsApp (contoh: 6281234567890)" class="border px-3 py-2 rounded-lg mt-3" />
            <textarea id="staffDesc" placeholder="Deskripsi singkat" class="border px-3 py-2 rounded-lg mt-3"></textarea>

            <div class="flex gap-2 mt-3">
              <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg">Simpan</button>
              <button type="button" id="btnCancelStaff" class="border px-4 py-2 rounded-lg">Batal</button>
            </div>
          </form>

          <div id="staffList" class="space-y-3"></div>
        </div>

      </div> <!-- end content -->
    </div> <!-- end admin container -->
  </div> <!-- end adminPanel -->

  <!-- SCRIPTS -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 700, once: true });

    /* ---------- STORAGE KEYS & DEFAULT DATA (menggunakan data lama kamu) ---------- */
    const LS_KEYS = {
      news: 'humas_bkk_news_v1',
      infoPT: 'humas_bkk_infopt_v1',
      jobs: 'humas_bkk_jobs_v1',
      staff: 'humas_bkk_staff_v1',
      logs: 'humas_bkk_logs_v1'
    };

    // Default data (saya masukkan data contoh dari kode lamamu)
    const DEFAULT_NEWS = [
      {
        id: cryptoId(),
        title: "Monitoring dan Evaluasi (MONEV) SMK Binaan PT. Astra Daihatsu Motor PBD Wilayah Jawa Tengah di SMK Ma‚Äôarif NU Bobotsari",
        date: "2025-10-13",
        image: "Monev.jpg",
        excerpt: "SMK Ma‚Äôarif NU Bobotsari menerima kunjungan dari PT. Astra Daihatsu Motor dalam kegiatan Monitoring dan Evaluasi (MONEV) Program Binaan Daihatsu (PBD) Wilayah Jawa Tengah pada 13 ",
        content: "<p>SMK Ma‚Äôarif NU Bobotsari menerima kunjungan dalam rangka Monitoring dan Evaluasi (MONEV) dari PT. Astra Daihatsu Motor selaku pembina SMK Program Pendidikan Binaan Daihatsu (PBD) Wilayah Jawa Tengah pada Senin, 13 Oktober 2025. Kegiatan ini bertujuan untuk melakukan evaluasi terhadap pelaksanaan program pembinaan sekolah, terutama dalam hal pengembangan kompetensi keahlian otomotif, peningkatan mutu pembelajaran, dan penyelarasan kurikulum dengan kebutuhan dunia industri. Tim asesor dari PT. Astra Daihatsu Motor, Revonda Andestadi dan Agus Ariesta, melakukan peninjauan terhadap sarana pembelajaran, dokumen administrasi, serta hasil implementasi program kerja sama industri di SMK Ma‚Äôarif NU Bobotsari. Kepala SMK Ma‚Äôarif NU Bobotsari, Dedy Utomo, S.Pd, menyampaikan apresiasi atas dukungan yang terus diberikan oleh pihak Astra Daihatsu Motor. Beliau menegaskan bahwa kegiatan ini menjadi langkah penting dalam memastikan keberlanjutan pembinaan, sekaligus memperkuat komitmen sekolah dalam menyiapkan lulusan yang siap kerja, kompeten, dan berkarakter unggul. Kegiatan berlangsung dengan lancar, penuh semangat, serta diakhiri dengan sesi dokumentasi bersama tim asesor dan pihak sekolah.",
        ts: Date.now() - (1000*60*60*24*10) // contoh timestamp
      },
      {
        id: cryptoId(),
        title: "Visitasi Industri ke Parkland World Indonesia (PWI Jepara)",
        date: "2025-10-02",
        image: "Pwi.jpg",
        excerpt: "Kunjungan untuk memperluas wawasan industri siswa dan hubungan magang.",
        content: "<p>SMK Ma'arif NU Bobotsari bersama BKK LP Ma'arif NU Jateng melakukan visitasi pada 2 Oktober 2025 di Parklan World Indonesia (PWI Jepara). Delegasi menerima paparan proses produksi dan peluang magang.</p>",
        ts: Date.now() - (1000*60*60*24*8)
      },
      {
        id: cryptoId(),
        title: "SMK Ma'arif NU Bobotsari & BKK LP Ma'arif NU Jateng Jalin MoU dengan PT Formosa Bag IndonesiaApel Pagi: Antisipasi Aksi Demo dan Pembinaan Siswa",
        date: "2025-10-02",
        image: "FBI.jpg",
        excerpt: "Kerjasama ini memperkuat jalur magang dan rekrutmen bagi lulusan SMK.",
        content: "<p>Penandatanganan MoU dilakukan pada 2 Oktober 2025 di kantor PT Formosa Bag Indonesia. Perwakilan sekolah dan BKK hadir untuk merancang program pelatihan dan penempatan kerja bagi lulusan SMK Ma'arif NU Bobotsari. Melalui kemitraan ini, siswa akan mendapat akses magang terstruktur dan peluang rekrutmen yang sesuai kompetensi mereka.</p>",
        ts: Date.now() - (1000*60*60*24*30)
      },
      { id: cryptoId(),
        title: "Rekapitulasi Realisasi Penggunaan Dana Bosp",
        date: "2025-07-04",
        image: "bosp.jpeg",
        excerpt: "Rekapitulasi Realisasi Penggunaan Dana Bosp periode tanggal : 01 Januari s.d 30Juni 2025 Tahap 1 Tahun 2025",
        content: "<p>SMK Ma‚Äôarif NU Bobotsari telah merilis laporan Rekapitulasi Realisasi Penggunaan Dana BOS Reguler Tahap 1 Tahun 2025 untuk periode 01 Januari‚Äì30 Juni 2025. Total dana yang diterima sebesar Rp 1.483.200.000, dengan realisasi penggunaan Rp 1.325.695.505 dan saldo akhir Rp 166.520.341. Laporan disusun secara transparan dan akuntabel sesuai Juknis BOS Tahun 2025.</p>",
        ts: Date.now() - (1000*60*60*24*30)
      }
    ];

    const DEFAULT_INFOPT = [
      { id: cryptoId(), title: "SNBP (Prestasi)", link: "https://portal-snpmb.bppp.kemdikbud.go.id/", image: "https://cdn-icons-png.flaticon.com/512/3135/3135755.png", excerpt: "Jalur undangan berdasarkan prestasi akademik & non-akademik."},
      { id: cryptoId(), title: "SNBT (Tes)", link: "https://portal-snpmb.bppp.kemdikbud.go.id/", image: "https://cdn-icons-png.flaticon.com/512/3135/3135715.png", excerpt: "Jalur tes UTBK-SNBT untuk masuk perguruan tinggi negeri."},
      { id: cryptoId(), title: "KIP Kuliah", link: "https://kip-kuliah.kemdiktisaintek.go.id/", image: "https://cdn-icons-png.flaticon.com/512/4762/4762314.png", excerpt: "Beasiswa untuk siswa berprestasi dari keluarga kurang mampu."}
    ];

    const DEFAULT_JOBS = [
      { id: cryptoId(), title: "Operator Produksi - PT Chemco Harapan Nusantara", company: "PT Chemco", image: "", link: "https://forms.gle/TXQjWWsADQzoygkm8", excerpt: "Untuk lulusan SMK Teknik Mesin. Gaji mulai Rp5.000.000/bulan."},
      { id: cryptoId(), title: "Seleksi Pendidikan - United Tractor School", company: "United Tractor", image: "", link: "https://forms.gle/m94Zto81Zi47trVd8", excerpt: "Untuk lulusan Teknik Mesin. Lokasi Tes: SMK Ma'arif Sumpiuh."}
    ];

    const DEFAULT_STAFF = [
      {id: cryptoId(), name: "Dedy Utomo, S.Pd", role: "Kepala Sekolah", image: "KS.jpg", desc: "", wa: "+6285728940098" },
      { id: cryptoId(), name: "Budi, S.Pd", role: "WKS. Bid Humas & Ketua BKK", image: "BUdi.jpg", desc: "", wa: "+6281227466276" },
      { id: cryptoId(), name: "Anita Mujiati, S.Pd", role: "Koord. KI, PKL & Bendahara BKK", image: "Anita.jpg", desc: "", wa: "+6285799985957" },
      { id: cryptoId(), name: "Iqbal Dia Rofatul", role: "Staff Administrasi Humas & BKK", image: "Iqbal-dia.jpg", desc: "", wa: "+6283136252917" }
    ];

    /* ---------- HELPERS ---------- */
    function cryptoId(){ return 'id-' + Math.random().toString(36).slice(2,9); }
    function getLS(key){ const raw = localStorage.getItem(key); if(!raw) return null; try { return JSON.parse(raw); } catch { return null; } }
    function setLS(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
    function addLog(text){ const logs = getLS(LS_KEYS.logs) || []; logs.unshift({id: cryptoId(), text, t: new Date().toISOString()}); setLS(LS_KEYS.logs, logs.slice(0,50)); renderAdminLog(); }

    function ensureDefaults(){
      if (!getLS(LS_KEYS.news)) setLS(LS_KEYS.news, DEFAULT_NEWS.slice());
      if (!getLS(LS_KEYS.infoPT)) setLS(LS_KEYS.infoPT, DEFAULT_INFOPT.slice());
      if (!getLS(LS_KEYS.jobs)) setLS(LS_KEYS.jobs, DEFAULT_JOBS.slice());
      if (!getLS(LS_KEYS.staff)) setLS(LS_KEYS.staff, DEFAULT_STAFF.slice());
      if (!getLS(LS_KEYS.logs)) setLS(LS_KEYS.logs, []);
    }

    function escapeHtml(unsafe){
      if (unsafe === null || unsafe === undefined) return '';
      return String(unsafe)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    /* ---------- RENDER PUBLIC ---------- */
    function renderNews(){
      const news = (getLS(LS_KEYS.news) || []).slice().sort((a,b)=> (b.ts||0) - (a.ts||0));
      const grid = document.getElementById('newsGrid'); grid.innerHTML = '';
      news.forEach(item=>{
        const el = document.createElement('article');
        el.className = 'bg-white rounded-xl shadow hover:shadow-lg transition p-4 flex flex-col';
        el.innerHTML = `
          <img src="${item.image || 'https://source.unsplash.com/800x450/?students,school'}" alt="${escapeHtml(item.title)}" class="card-img mb-3">
          <h3 class="text-lg font-semibold text-green-700">${escapeHtml(item.title)}</h3>
          <p class="text-xs text-gray-600 mt-1">${escapeHtml(item.date||'')}</p>
          <p class="text-sm mt-2 text-gray-700 line-clamp-4">${escapeHtml(item.excerpt||'')}</p>
          <details class="mt-3">
            <summary class="cursor-pointer text-green-600 font-semibold hover:underline">Baca Selengkapnya ‚Üí</summary>
            <div class="mt-2 text-sm text-gray-700">${item.content || ''}</div>
          </details>
        `;
        grid.appendChild(el);
      });
      document.getElementById('countNews').textContent = (news.length||0);
    }

    function renderInfoPT(){
      const arr = getLS(LS_KEYS.infoPT) || [];
      const grid = document.getElementById('infoPTGrid'); grid.innerHTML = '';
      arr.forEach(i=>{
        const card = document.createElement('div');
        card.className = 'bg-white p-5 rounded-xl shadow hover:shadow-lg transition flex flex-col';
        card.innerHTML = `
          <img src="${i.image || 'https://source.unsplash.com/160x90/?university'}" class="h-16 mb-3 w-20 object-contain" alt="">
          <h3 class="text-green-700 font-semibold text-lg">${escapeHtml(i.title)}</h3>
          <p class="text-sm text-gray-700 mt-2">${escapeHtml(i.excerpt||'')}</p>
          <a href="${i.link||'#'}" target="_blank" class="inline-block mt-3 text-white bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg font-semibold">Info</a>
        `;
        grid.appendChild(card);
      });
      document.getElementById('countInfoPT').textContent = arr.length;
    }

    function renderJobs(){
      const arr = getLS(LS_KEYS.jobs) || [];
      const grid = document.getElementById('jobsGrid'); grid.innerHTML = '';
      arr.forEach(i=>{
        const card = document.createElement('div');
        card.className = 'bg-white p-5 rounded-xl shadow hover:shadow-lg transition flex flex-col items-start';
        card.innerHTML = `
          <img src="${i.image || 'https://source.unsplash.com/160x90/?office,work'}" class="h-16 mb-3 w-20 object-contain" alt="Logo Perusahaan">
          <h3 class="text-green-700 font-semibold text-lg">${escapeHtml(i.title)}</h3>
          <p class="text-sm text-gray-700 mt-2">${escapeHtml(i.excerpt||'')}</p>
          <a href="${i.link||'#'}" target="_blank" class="inline-block mt-3 text-white bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg font-semibold">Apply</a>
        `;
        grid.appendChild(card);
      });
      document.getElementById('countJobs').textContent = arr.length;
    }

    function renderStaff(){
      const arr = getLS(LS_KEYS.staff) || [];
      const grid = document.getElementById('staffGrid'); grid.innerHTML = '';
      arr.forEach(i=>{
        const col = document.createElement('div');
        col.className = 'bg-white p-5 rounded-xl shadow hover:shadow-lg transition flex flex-col items-center';
        const waBtn = i.wa ? `<a href="https://wa.me/${i.wa}" target="_blank" class="mt-3 inline-block bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold"><i class='fab fa-whatsapp mr-2'></i>Hubungi via WhatsApp</a>` : '';
        col.innerHTML = `
          <img src="${i.image || 'https://source.unsplash.com/200x200/?person'}" class="rounded-circle h-28 w-28 border-4 border-green-600 mb-3" alt="">
          <h4 class="text-green-700 font-semibold">${escapeHtml(i.name)}</h4>
          <p class="text-sm text-gray-700">${escapeHtml(i.role||'')}</p>
          ${waBtn}
          <p class="text-sm text-gray-600 mt-2">${escapeHtml(i.desc||'')}</p>
        `;
        grid.appendChild(col);
      });
    }

    /* ---------- ADMIN RENDER ---------- */
    function renderAdminLog(){
      const logs = getLS(LS_KEYS.logs) || [];
      const ul = document.getElementById('adminLog');
      ul.innerHTML = logs.slice(0,30).map(l => `<li>${escapeHtml(l.text)} <span class="text-xs text-gray-400">¬∑ ${new Date(l.t).toLocaleString()}</span></li>`).join('');
    }

    function renderNewsList(){
      const arr = (getLS(LS_KEYS.news) || []).slice().sort((a,b)=> (b.ts||0)-(a.ts||0));
      const list = document.getElementById('newsList');
      list.innerHTML = arr.map(item => `
        <div class="p-3 border rounded-lg flex items-start gap-3">
          <img src="${item.image || 'https://source.unsplash.com/100x80/?students'}" class="h-20 w-28 object-cover rounded-md">
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-semibold">${escapeHtml(item.title)}</div>
                <div class="text-xs text-gray-500">${escapeHtml(item.date||'')}</div>
              </div>
              <div class="flex gap-2">
                <button data-id="${item.id}" class="edit-news text-sm bg-yellow-100 text-yellow-700 px-3 py-1 rounded">Edit</button>
                <button data-id="${item.id}" class="del-news text-sm bg-red-100 text-red-700 px-3 py-1 rounded">Hapus</button>
              </div>
            </div>
            <div class="text-sm text-gray-600 mt-2">${escapeHtml(item.excerpt||'')}</div>
          </div>
        </div>
      `).join('');
    }

    function renderInfoList(){
      const arr = getLS(LS_KEYS.infoPT) || [];
      document.getElementById('infoList').innerHTML = arr.map(i=> `
        <div class="p-3 border rounded-lg flex items-start gap-3">
          <img src="${i.image || 'https://source.unsplash.com/100x80/?college'}" class="h-16 w-24 object-cover rounded-md">
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-semibold">${escapeHtml(i.title)}</div>
                <div class="text-xs text-gray-500">${escapeHtml(i.link||'')}</div>
              </div>
              <div class="flex gap-2">
                <button data-id="${i.id}" class="edit-info text-sm bg-yellow-100 text-yellow-700 px-3 py-1 rounded">Edit</button>
                <button data-id="${i.id}" class="del-info text-sm bg-red-100 text-red-700 px-3 py-1 rounded">Hapus</button>
              </div>
            </div>
            <div class="text-sm text-gray-600 mt-2">${escapeHtml(i.excerpt||'')}</div>
          </div>
        </div>
      `).join('');
    }

    function renderJobList(){
      const arr = getLS(LS_KEYS.jobs) || [];
      document.getElementById('jobList').innerHTML = arr.map(i=> `
        <div class="p-3 border rounded-lg flex items-start gap-3">
          <img src="${i.image || 'https://source.unsplash.com/100x80/?office'}" class="h-16 w-24 object-cover rounded-md">
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-semibold">${escapeHtml(i.title)}</div>
                <div class="text-xs text-gray-500">${escapeHtml(i.company||'')}</div>
              </div>
              <div class="flex gap-2">
                <button data-id="${i.id}" class="edit-job text-sm bg-yellow-100 text-yellow-700 px-3 py-1 rounded">Edit</button>
                <button data-id="${i.id}" class="del-job text-sm bg-red-100 text-red-700 px-3 py-1 rounded">Hapus</button>
              </div>
            </div>
            <div class="text-sm text-gray-600 mt-2">${escapeHtml(i.excerpt||'')}</div>
          </div>
        </div>
      `).join('');
    }

    function renderStaffList(){
      const arr = getLS(LS_KEYS.staff) || [];
      document.getElementById('staffList').innerHTML = arr.map(i=> `
        <div class="p-3 border rounded-lg flex items-start gap-3">
          <img src="${i.image || 'https://source.unsplash.com/100x100/?person'}" class="h-16 w-16 object-cover rounded-full">
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-semibold">${escapeHtml(i.name)}</div>
                <div class="text-xs text-gray-500">${escapeHtml(i.role||'')}</div>
                <div class="text-xs text-gray-400 mt-1">WA: ${escapeHtml(i.wa||'-')}</div>
              </div>
              <div class="flex gap-2">
                <button data-id="${i.id}" class="edit-staff text-sm bg-yellow-100 text-yellow-700 px-3 py-1 rounded">Edit</button>
                <button data-id="${i.id}" class="del-staff text-sm bg-red-100 text-red-700 px-3 py-1 rounded">Hapus</button>
              </div>
            </div>
            <div class="text-sm text-gray-600 mt-2">${escapeHtml(i.desc||'')}</div>
          </div>
        </div>
      `).join('');
    }

    /* ---------- ADMIN ACTIONS ---------- */
    const ADMIN_ACCOUNT = {user: 'admin', pass: 'admin123'}; // bisa diganti

    document.getElementById('btn-admin-open').addEventListener('click', (e)=>{
      e.preventDefault();
      document.getElementById('loginModal').classList.remove('hidden');
      document.getElementById('loginModal').classList.add('flex');
    });
    document.getElementById('loginClose').addEventListener('click', hideLogin);
    function hideLogin(){ document.getElementById('loginModal').classList.add('hidden'); document.getElementById('loginModal').classList.remove('flex'); }

    document.getElementById('loginBtn').addEventListener('click', ()=>{
      const u = document.getElementById('loginUser').value.trim();
      const p = document.getElementById('loginPass').value.trim();
      if(u === ADMIN_ACCOUNT.user && p === ADMIN_ACCOUNT.pass){
        hideLogin(); openAdmin(); addLog('Admin logged in');
      } else alert('Username atau password salah.');
    });

    function openAdmin(){
      document.getElementById('adminPanel').style.display = 'block';
      document.getElementById('adminName').textContent = ADMIN_ACCOUNT.user;
      showAdminSection('dash'); renderAllAdmin(); window.scrollTo({top:0, behavior:'smooth'});
    }
    document.getElementById('btnLogout').addEventListener('click', ()=>{
      document.getElementById('adminPanel').style.display = 'none';
      addLog('Admin logged out');
    });

    document.querySelectorAll('.admin-menu').forEach(btn=>{
      btn.addEventListener('click', ()=> showAdminSection(btn.getAttribute('data-section')));
    });

    function showAdminSection(section){
      document.querySelectorAll('.admin-section').forEach(el=> el.classList.add('hidden'));
      document.getElementById('admin-dash').classList.toggle('hidden', section !== 'dash');
      document.getElementById('admin-berita').classList.toggle('hidden', section !== 'berita');
      document.getElementById('admin-infopt').classList.toggle('hidden', section !== 'infopt');
      document.getElementById('admin-lowongan').classList.toggle('hidden', section !== 'lowongan');
      document.getElementById('admin-pengurus').classList.toggle('hidden', section !== 'pengurus');
    }

    function renderAllAdmin(){
      // Pastikan berita selalu diurutkan terbaru dulu
      let news = getLS(LS_KEYS.news) || [];
      news.sort((a,b)=> (b.ts||0)-(a.ts||0));
      setLS(LS_KEYS.news, news);

      renderNewsList(); renderInfoList(); renderJobList(); renderStaffList(); renderAdminLog();
      // public
      renderNews(); renderInfoPT(); renderJobs(); renderStaff();
      attachAdminHandlers();
    }

    // News handlers
    document.getElementById('btnNewNews').addEventListener('click', ()=> {
      document.getElementById('formNews').classList.remove('hidden');
      document.getElementById('newsId').value=''; document.getElementById('newsTitle').value=''; document.getElementById('newsDate').value=new Date().toISOString().slice(0,10);
      document.getElementById('newsImage').value=''; document.getElementById('newsExcerpt').value=''; document.getElementById('newsContent').value='';
      window.scrollTo({top:0, behavior:'smooth'});
    });
    document.getElementById('btnCancelNews').addEventListener('click', ()=> document.getElementById('formNews').classList.add('hidden'));
    document.getElementById('btnCloseNewsPanel').addEventListener('click', ()=> showAdminSection('dash'));

    document.getElementById('formNews').addEventListener('submit', (e)=>{
      e.preventDefault();
      const id = document.getElementById('newsId').value || cryptoId();
      const title = document.getElementById('newsTitle').value.trim();
      const date = document.getElementById('newsDate').value || '';
      const image = document.getElementById('newsImage').value.trim();
      const excerpt = document.getElementById('newsExcerpt').value.trim();
      const content = document.getElementById('newsContent').value.trim();
      let arr = getLS(LS_KEYS.news) || [];
      const ts = Date.now();
      const obj = { id, title, date, image, excerpt, content, ts };
      const exists = arr.find(i=>i.id===id);
      if(exists){
        arr = arr.map(i=> i.id===id ? {...exists, ...obj} : i);
        addLog('Edit berita: ' + title);
      } else {
        arr.push(obj);
        addLog('Tambah berita: ' + title);
      }
      // sort newest first by ts
      arr.sort((a,b)=> (b.ts||0) - (a.ts||0));
      setLS(LS_KEYS.news, arr);
      document.getElementById('formNews').classList.add('hidden');
      renderAllAdmin();
      showAdminSection('berita');
    });

    function attachAdminHandlers(){
      // attach edit/delete buttons (news)
      document.querySelectorAll('.edit-news').forEach(btn=>{
        btn.onclick = ()=>{
          const id = btn.getAttribute('data-id');
          const arr = getLS(LS_KEYS.news) || [];
          const it = arr.find(i=>i.id===id);
          if(!it) return;
          document.getElementById('formNews').classList.remove('hidden');
          document.getElementById('newsId').value = it.id;
          document.getElementById('newsTitle').value = it.title;
          document.getElementById('newsDate').value = it.date || '';
          document.getElementById('newsImage').value = it.image || '';
          document.getElementById('newsExcerpt').value = it.excerpt || '';
          document.getElementById('newsContent').value = it.content || '';
          window.scrollTo({top:0, behavior:'smooth'});
        };
      });
      document.querySelectorAll('.del-news').forEach(btn=>{
        btn.onclick = ()=>{
          if(!confirm('Hapus berita ini?')) return;
          const id = btn.getAttribute('data-id');
          let arr = getLS(LS_KEYS.news) || [];
          const it = arr.find(i=>i.id===id);
          arr = arr.filter(i=>i.id!==id);
          setLS(LS_KEYS.news, arr);
          addLog('Hapus berita: '+ (it ? it.title : id));
          renderAllAdmin();
        };
      });

      // Info PT handlers
      document.getElementById('btnNewInfoPT').onclick = ()=>{
        document.getElementById('formInfoPT').classList.remove('hidden');
        document.getElementById('infoId').value=''; document.getElementById('infoTitle').value=''; document.getElementById('infoLink').value=''; document.getElementById('infoImage').value=''; document.getElementById('infoExcerpt').value='';
      };
      document.getElementById('btnCancelInfo').onclick = ()=> document.getElementById('formInfoPT').classList.add('hidden');
      document.getElementById('formInfoPT').onsubmit = (e)=>{
        e.preventDefault();
        const id = document.getElementById('infoId').value || cryptoId();
        const title = document.getElementById('infoTitle').value.trim();
        const link = document.getElementById('infoLink').value.trim();
        const image = document.getElementById('infoImage').value.trim();
        const excerpt = document.getElementById('infoExcerpt').value.trim();
        let arr = getLS(LS_KEYS.infoPT) || [];
        const obj = { id, title, link, image, excerpt };
        if(arr.find(i=>i.id===id)) arr = arr.map(i=> i.id===id ? obj : i);
        else arr.push(obj);
        setLS(LS_KEYS.infoPT, arr);
        addLog('Simpan Info PT: ' + title);
        document.getElementById('formInfoPT').classList.add('hidden');
        renderAllAdmin();
      };
      document.querySelectorAll('.edit-info').forEach(btn=>{
        btn.onclick = ()=>{
          const id = btn.getAttribute('data-id'); const arr = getLS(LS_KEYS.infoPT)||[]; const it = arr.find(i=>i.id===id);
          if(!it) return;
          document.getElementById('formInfoPT').classList.remove('hidden');
          document.getElementById('infoId').value = it.id;
          document.getElementById('infoTitle').value = it.title;
          document.getElementById('infoLink').value = it.link || '';
          document.getElementById('infoImage').value = it.image || '';
          document.getElementById('infoExcerpt').value = it.excerpt || '';
        };
      });
      document.querySelectorAll('.del-info').forEach(btn=>{
        btn.onclick = ()=>{
          if(!confirm('Hapus info PT ini?')) return;
          const id = btn.getAttribute('data-id');
          let arr = getLS(LS_KEYS.infoPT) || [];
          const it = arr.find(i=>i.id===id);
          arr = arr.filter(i=>i.id!==id);
          setLS(LS_KEYS.infoPT, arr);
          addLog('Hapus Info PT: '+ (it ? it.title : id));
          renderAllAdmin();
        };
      });

      // Job handlers
      document.getElementById('btnNewJob').onclick = ()=>{
        document.getElementById('formJob').classList.remove('hidden');
        document.getElementById('jobId').value=''; document.getElementById('jobTitle').value=''; document.getElementById('jobCompany').value=''; document.getElementById('jobImage').value=''; document.getElementById('jobLink').value=''; document.getElementById('jobExcerpt').value='';
      };
      document.getElementById('btnCancelJob').onclick = ()=> document.getElementById('formJob').classList.add('hidden');
      document.getElementById('formJob').onsubmit = (e)=>{
        e.preventDefault();
        const id = document.getElementById('jobId').value || cryptoId();
        const title = document.getElementById('jobTitle').value.trim();
        const company = document.getElementById('jobCompany').value.trim();
        const image = document.getElementById('jobImage').value.trim();
        const link = document.getElementById('jobLink').value.trim();
        const excerpt = document.getElementById('jobExcerpt').value.trim();
        let arr = getLS(LS_KEYS.jobs) || [];
        const obj = { id, title, company, image, link, excerpt };
        if(arr.find(i=>i.id===id)) arr = arr.map(i=> i.id===id ? obj : i);
        else arr.push(obj);
        setLS(LS_KEYS.jobs, arr);
        addLog('Simpan lowongan: ' + title);
        document.getElementById('formJob').classList.add('hidden');
        renderAllAdmin();
      };
      document.querySelectorAll('.edit-job').forEach(btn=>{
        btn.onclick = ()=>{
          const id = btn.getAttribute('data-id'); const arr = getLS(LS_KEYS.jobs)||[]; const it = arr.find(i=>i.id===id);
          if(!it) return;
          document.getElementById('formJob').classList.remove('hidden');
          document.getElementById('jobId').value = it.id;
          document.getElementById('jobTitle').value = it.title;
          document.getElementById('jobCompany').value = it.company || '';
          document.getElementById('jobImage').value = it.image || '';
          document.getElementById('jobLink').value = it.link || '';
          document.getElementById('jobExcerpt').value = it.excerpt || '';
        };
      });
      document.querySelectorAll('.del-job').forEach(btn=>{
        btn.onclick = ()=>{
          if(!confirm('Hapus lowongan ini?')) return;
          const id = btn.getAttribute('data-id');
          let arr = getLS(LS_KEYS.jobs) || [];
          const it = arr.find(i=>i.id===id);
          arr = arr.filter(i=>i.id!==id);
          setLS(LS_KEYS.jobs, arr);
          addLog('Hapus lowongan: '+ (it ? it.title : id));
          renderAllAdmin();
        };
      });

      // Staff handlers
      document.getElementById('btnNewStaff').onclick = ()=>{
        document.getElementById('formStaff').classList.remove('hidden');
        document.getElementById('staffId').value=''; document.getElementById('staffName').value=''; document.getElementById('staffRole').value=''; document.getElementById('staffImage').value=''; document.getElementById('staffDesc').value='';
      };
      document.getElementById('btnCancelStaff').onclick = ()=> document.getElementById('formStaff').classList.add('hidden');
      document.getElementById('formStaff').onsubmit = (e)=>{
        e.preventDefault();
        const id = document.getElementById('staffId').value || cryptoId();
        const name = document.getElementById('staffName').value.trim();
        const role = document.getElementById('staffRole').value.trim();
        const image = document.getElementById('staffImage').value.trim();
        const wa = document.getElementById('staffWA').value.trim();
        const desc = document.getElementById('staffDesc').value.trim();
        let arr = getLS(LS_KEYS.staff) || [];
        const obj = { id, name, role, image, desc, wa };
        if(arr.find(i=>i.id===id)) arr = arr.map(i=> i.id===id ? obj : i);
        else arr.push(obj);
        setLS(LS_KEYS.staff, arr);
        addLog('Simpan pengurus: ' + name);
        document.getElementById('formStaff').classList.add('hidden');
        renderAllAdmin();
      };
      document.querySelectorAll('.edit-staff').forEach(btn=>{
        btn.onclick = ()=>{
          const id = btn.getAttribute('data-id'); const arr = getLS(LS_KEYS.staff)||[]; const it = arr.find(i=>i.id===id);
          if(!it) return;
          document.getElementById('formStaff').classList.remove('hidden');
          document.getElementById('staffId').value = it.id;
          document.getElementById('staffName').value = it.name || '';
          document.getElementById('staffRole').value = it.role || '';
          document.getElementById('staffImage').value = it.image || '';
          document.getElementById('staffWA').value = it.wa || '';
          document.getElementById('staffDesc').value = it.desc || '';
        };
      });
      document.querySelectorAll('.del-staff').forEach(btn=>{
        btn.onclick = ()=>{
          if(!confirm('Hapus pengurus ini?')) return;
          const id = btn.getAttribute('data-id');
          let arr = getLS(LS_KEYS.staff) || [];
          const it = arr.find(i=>i.id===id);
          arr = arr.filter(i=>i.id!==id);
          setLS(LS_KEYS.staff, arr);
          addLog('Hapus pengurus: '+ (it ? it.name : id));
          renderAllAdmin();
        };
      });

      // Export & Import & Reset
      document.getElementById('btnExport').onclick = ()=>{
        const data = {
          news: getLS(LS_KEYS.news) || [],
          infoPT: getLS(LS_KEYS.infoPT) || [],
          jobs: getLS(LS_KEYS.jobs) || [],
          staff: getLS(LS_KEYS.staff) || [],
          logs: getLS(LS_KEYS.logs) || []
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'humas-bkk-data.json';
        a.click();
        URL.revokeObjectURL(a.href);
        addLog('Export data JSON');
      };

      document.getElementById('importFile').onchange = (e)=>{
        const f = e.target.files[0];
        if(!f) return;
        const reader = new FileReader();
        reader.onload = (ev)=>{
          try{
            const obj = JSON.parse(ev.target.result);
            if(obj.news) setLS(LS_KEYS.news, obj.news);
            if(obj.infoPT) setLS(LS_KEYS.infoPT, obj.infoPT);
            if(obj.jobs) setLS(LS_KEYS.jobs, obj.jobs);
            if(obj.staff) setLS(LS_KEYS.staff, obj.staff);
            if(obj.logs) setLS(LS_KEYS.logs, obj.logs);
            addLog('Import data JSON');
            renderAllAdmin();
            alert('Import berhasil.');
          } catch(err){
            alert('Gagal membaca file JSON: ' + err.message);
          }
        };
        reader.readAsText(f);
        e.target.value = '';
      };

      document.getElementById('btnReset').onclick = ()=>{
        if(!confirm('Reset semua data ke default? Ini akan menimpa data saat ini.')) return;
        localStorage.removeItem(LS_KEYS.news); localStorage.removeItem(LS_KEYS.infoPT); localStorage.removeItem(LS_KEYS.jobs); localStorage.removeItem(LS_KEYS.staff); localStorage.removeItem(LS_KEYS.logs);
        ensureDefaults(); addLog('Reset data ke default'); renderAllAdmin();
      };
    } // end attachAdminHandlers

    /* ---------- NAVBAR active on scroll & back to top ---------- */
    const sections = document.querySelectorAll("section");
    const navLinks = document.querySelectorAll(".nav-link");
    window.addEventListener("scroll", () => {
      let current = '';
      sections.forEach(section => {
        const top = section.offsetTop - 160;
        if (scrollY >= top) current = section.getAttribute('id');
      });
      navLinks.forEach(link => {
        link.classList.remove('nav-active');
        if (link.getAttribute('href') === `#${current}`) link.classList.add('nav-active');
      });

      const toTop = document.getElementById('toTop');
      if (window.scrollY > 500) toTop.classList.remove('hidden'); else toTop.classList.add('hidden');
    });

    document.getElementById('toTop').addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

    /* ---------- INITIALIZE ---------- */
    ensureDefaults();
    renderAllAdmin();

    // quick-add news button on page (will open admin form if logged in)
    document.getElementById('btn-add-news-quick').addEventListener('click', ()=>{
      if(document.getElementById('adminPanel').style.display === 'block') {
        showAdminSection('berita');
        document.getElementById('btnNewNews').click();
      } else {
        alert('Silakan masuk sebagai admin untuk menambah berita.');
      }
    });

  </script>
</body>
</html>
